---
---

<!-- Botón de búsqueda -->
<button
  id="open-search"
  class="px-3 py-1.5 rounded-full border border-emerald-500 text-emerald-600 hover:bg-emerald-100 dark:text-emerald-300 dark:border-emerald-400 dark:hover:bg-emerald-800 transition"
>
  Buscar
</button>

<!-- Modal -->
<div
  id="search-modal"
  class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden items-center justify-center z-[9999]"
>
  <div class="bg-white dark:bg-emerald-900 rounded-xl shadow-lg max-w-lg w-full p-6 relative">
    <!-- Cerrar -->
    <button
      id="close-search"
      class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200"
    >
      ✕
    </button>

    <!-- Input -->
    <input
      id="search"
      type="text"
      placeholder="Buscar perfiles..."
      class="w-full px-4 py-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-emerald-500"
    />

    <!-- Resultados -->
    <ul id="results" class="mt-4 space-y-2 max-h-72 overflow-y-auto"></ul>
  </div>
</div>

<script is:inline>
  const openBtn = document.getElementById("open-search");
  const closeBtn = document.getElementById("close-search");
  const modal = document.getElementById("search-modal");
  const input = document.getElementById("search");
  const results = document.getElementById("results");

  // Abrir modal
  openBtn.addEventListener("click", () => {
    modal.classList.remove("hidden");
    modal.classList.add("flex");
    input.focus();
  });

  // Cerrar modal
  closeBtn.addEventListener("click", () => {
    modal.classList.add("hidden");
    modal.classList.remove("flex");
    results.innerHTML = "";
    input.value = "";
  });

  let controller;
  input.addEventListener("input", async (e) => {
    const q = e.target.value.trim();
    if (controller) controller.abort();
    controller = new AbortController();
    if (!q) { results.innerHTML = ""; return; }

    const res = await fetch(`/api/profiles/search?q=${encodeURIComponent(q)}`, { signal: controller.signal });
    if (!res.ok) return;
    const users = await res.json();

    results.innerHTML = "";
    for (const u of users) {
      const li = document.createElement("li");
      li.innerHTML = `
        <a href="/perfil/${u.id}" 
           class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">
          <img src="${u.avatar_url ?? "/default-avatar.webp"}" class="w-10 h-10 rounded-full object-cover" />
          <div>
            <p class="font-medium">${u.nombre ?? ""} ${u.apellidos ?? ""}</p>
            <p class="text-sm text-gray-500">${u.bio ?? ""}</p>
          </div>
        </a>
      `;
      results.appendChild(li);
    }
  });
</script>
