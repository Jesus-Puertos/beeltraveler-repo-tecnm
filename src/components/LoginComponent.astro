---
import { createClient } from '@supabase/supabase-js';

// Cliente Supabase
const supabase = createClient(import.meta.env.PUBLIC_SUPABASE_URL, import.meta.env.PUBLIC_SUPABASE_ANON_KEY);
---

<form method="post" action="/api/auth/signin" class="p-4 bg-white rounded shadow">
  <label>Email</label>
  <input type="email" name="email" required />

  <label>Password</label>
  <input type="password" name="password" required />

  <button type="submit">Iniciar sesión</button>
</form>


<script is:inline>
  import { createClient } from '@supabase/supabase-js';
  const supabase = createClient(import.meta.env.PUBLIC_SUPABASE_URL, import.meta.env.PUBLIC_SUPABASE_ANON_KEY);

  const form = document.getElementById("registrationForm");
  const registerButton = document.getElementById("registerButton");

  form.addEventListener("input", () => {
    registerButton.disabled = !form.checkValidity();
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    const repeat = document.getElementById("repeat-password").value;

    if (password !== repeat) {
      alert("Las contraseñas no coinciden");
      return;
    }

    // Registro en Supabase
    const { data, error } = await supabase.auth.signUp({ email, password });

    if (error) {
      alert("Error creando cuenta: " + error.message);
      return;
    }

    // Crear perfil inicial
    await supabase.from("profiles").insert([
      { id: data.user.id, email: email, facetec_status: "pending" }
    ]);

    // Redirigir a FaceTec (simulado)
    window.location.href = "https://browser.facetec.com/";
  });
</script>
