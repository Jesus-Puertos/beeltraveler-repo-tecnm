---
// Update the import path if the file exists elsewhere, for example:
import { supabaseServer } from "../lib/supabaseServer";
// Or, if the file does not exist, create it in src/lib/supabaseServer.js or .ts

export const prerender = false;

import type { APIContext } from "astro";

export async function get({ cookies, url, redirect }: APIContext) {
  const supabase = supabaseServer(cookies);
  const { data: { session } } = await supabase.auth.getSession();

  if (!session) return redirect("/signin");

  const userId = session.user.id;
  return { props: { userId } };
}
---

<html>
  <body class="p-8">
    <h1>Verificación Biométrica (Demo)</h1>
    <p>Esto simula la integración con FaceTec. Al dar clic en el botón, se marcará como <b>verified</b>.</p>

    <form method="post" action="/api/facetec/verify">
      <input type="hidden" name="user_id" value={Astro.props.userId} />
      <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded">
        Simular verificación FaceTec ✅
      </button>
    </form>
  </body>
</html>
