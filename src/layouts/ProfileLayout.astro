---
import "../styles/global.css";

import "@fontsource-variable/geist";

import { createClient } from "@supabase/supabase-js";


const { cookies } = Astro;

let user = null;
let displayName = null;
let avatar = null;

// Recuperar el token de la cookie de este navegador
const accessToken = cookies.get("sb-access-token");

if (accessToken) {
  const supabaseServer = createClient(
    import.meta.env.SUPABASE_URL,
    import.meta.env.SUPABASE_ANON_KEY,
    {
      global: {
        headers: { Authorization: `Bearer ${accessToken.value}` },
      },
    }
  );

  // ðŸ”‘ Obtener usuario logueado
  const { data: { user: currentUser } } = await supabaseServer.auth.getUser();

  if (currentUser) {
    user = currentUser;

    // ðŸ”Ž Obtener datos del perfil
    const { data: profileData } = await supabaseServer
      .from("profiles")
      .select("nombre, avatar_url")
      .eq("id", user.id)
      .single();

    displayName = profileData?.nombre ?? "Usuario";
    avatar = profileData?.avatar_url ?? "/default-avatar.webp";
  }
}
---

<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>BeelPedia</title>
   
  </head>
  <body class="bg-white md:pl-60 pb-16">
      <div
        class="m-auto dark:bg-[radial-gradient(circle_500px_at_50%_200px,#3e3e3e,transparent)]"
      >
      <slot />
      </div>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/preline@2.4.1/dist/preline.js" defer></script>

  <style is:global>
    :root {
      color-scheme: light dark;
    }

    body {
      font-family: "Geist Variable", sans-serif;
    }
  </style>
</html>
